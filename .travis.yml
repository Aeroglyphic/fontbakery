language: python
branches:
  only:
    - master
before_install:
  - sudo add-apt-repository --yes ppa:fontforge/fontforge
  - sudo apt-get update -qq
  - sudo apt-get install python-fontforge ttfautohint swig
  - pip install --upgrade pip
install:
  - export LD_LIBRARY_PATH=/usr/local/lib
  - cp /usr/lib/python2.7/dist-packages/fontforge.* /home/travis/virtualenv/python2.7.12/lib/python2.7/site-packages
  - pip install BeautifulSoup4
  - pip install filemagic
  - pip install requests
  - pip install flake8
  - pip install protobuf
  - pip install unidecode
  - pip install lxml
  - pip install defusedxml
  - pip install tabulate
  - pip install pillow
  - pip install flask
  - pip install pylint
  - "pip install git+https://github.com/behdad/fonttools.git"
  - "pip install git+https://github.com/googlei18n/glyphsLib.git"
script:
  - export FLAKE8IGNORE=E111,E114,E701,E121,E266,E221,E226,E126,W191,W293
  - export WONT_FIX=invalid-name,bad-indentation
  - export MAYBE_SOMEDAY=fixme,missing-docstring,redefined-outer-name,too-many-locals,assignment-from-no-return,no-member,too-many-branches,too-many-statements,bad-continuation,unidiomatic-typecheck,logging-format-interpolation,too-many-nested-blocks,unused-variable
  - export PYLINT="pylint --disable=$WONT_FIX,$MAYBE_SOMEDAY"
  - $PYLINT fontbakery-check-ttf.py
  - flake8 --statistics fontbakery-check-description.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics fontbakery-check-upstream.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics fbchecklogger.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics utils.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics constants.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics checks.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics upstreamdirectory.py --ignore=$FLAKE8IGNORE
  - flake8 --statistics pifont.py --ignore=$FLAKE8IGNORE
  - python fontbakery-check-ttf.py data/test/cousine/*.ttf --ghm --json
  - python fontbakery-check-ttf.py data/test/mada/*.ttf --ghm --json
  - python fontbakery-check-ttf.py data/test/merriweather/*.ttf --ghm --json
  - python fontbakery-check-ttf.py data/test/nunito/*.ttf --ghm --json
  - python fontbakery-check-ttf.py data/test/familysans/*.ttf --ghm --json
  - python fontbakery-check-ttf.py data/test/cabin/*.ttf --ghm --json
  - python test_args.py
