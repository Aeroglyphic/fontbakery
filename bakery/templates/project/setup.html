{% extends "project/base.html" %}
{% set page_title = _("Setup Repository") %}

{% block body %}

{% from 'project/macros.html' import nav with context%}
{{ nav('setup') }}

{% set config = project.config %}
{% if config['local'].get('status', None) == 'repo' %}
  {% set dis = 'disabled' %}
{% else %}
  {% set dis = '' %}
{% endif %}

<form id="setup" class="form-horizontal" action="{{ url_for('project.setup', project_id = project.id)}}" method="POST">
  <div class="control-group">
    <label class="control-label" for="license_file">License file</label>
    <div class="controls">
    <select for="license_file" name="license_file" class="input-xxlarge" {{dis}}>
      <option>Select file</option>
      {% for i in config['local']['txt_files'] %}
      <option {% if config['state']['license_file']==i %}selected="selected"{% endif %} >{{ i }}</option>
      {% endfor %}
    </select>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="ufo_folders">Ufo folders</label>
    <div class="controls">
    <select for="ufo_folders" multiple="multiple" name="ufo" class="input-xxlarge" 
        size="{{ config['local']['ufo_dirs']|length }}" {{dis}}>
      {% for i in config['local']['ufo_dirs'] %}
      <option {% if i in config['state']['ufo'] %}selected="selected"{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="subset">Subset checks</label>
    <div class="controls">
    <select for="subset" multiple="multiple" name="subset" class="input-xxlarge" 
      size="{{ subsetvals|length }}" {{dis}}>
      {% for i in subsetvals %}
      <option {% if i in config['state']['subset'] %}selected="selected"{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    </div>
  </div>

<!--   <div class="control-group">
    <div class="controls">
    <label class="radio">
      <input type="radio" name="rename" id="rename1" value="no" {% if not config['state']['familyname'] %}checked{% endif %}>
      Use the same font family name?
    </label>
    <label class="radio">
      <input type="radio" name="rename" id="reanme2" value="yes" {% if config['state']['familyname'] %}checked{% endif %}>
      I want to define new font family name?
    </label>
    </div>
  </div>
 -->
  <div id="familyname" class="control-group">
    <label class="control-label" for="familyname">Define new font family name</label>
    <div class="controls">
    <input type="text" placeholder="Type new params…" name="familyname" 
      value="{{ config['state'].get('familyname', '') }}" 
      class="input-xxlarge" {{dis}}>
    </div>
  </div>

<!--   <div class="control-group">
    <div class="controls">
    <label class="radio">
      <input type="radio" name="ttfautohintuse" id="ttf1" value="no" {% if not config['state']['ttfautohintuse'] %}checked{% endif %}>
      Don't use <code>ttfautohint</code> processing
    </label>
    <label class="radio">
      <input type="radio" name="ttfautohintuse" id="ttf2" value="yes" {% if config['state']['ttfautohintuse'] %}checked{% endif %}>
      I need <code>ttfautohint</code> 
    </label>
    </div>
  </div>
 -->

  <div class="control-group">
    <label class="control-label" for="ttfautohint"><code>ttfautohint</code> params</label>
    <div class="controls">
    <input type="text" placeholder="Type new params…" name="ttfautohint" 
      value="{{ config['state'].get('ttfautohint', '') }}" 
      class="input-xxlarge" {{dis}}>
    </div>
  </div>

  {% if config['local'].get('status', None) == 'repo' %}
    <p> 
    Set these values from <code>bakery.yaml</code> in your repository.
    </p>

  {% else %}
  <div class="control-group">
    <div class="controls">
      <button type="submit" class="btn btn-primary" {% if not config['local']['setup'] %} data-confirm="Do you have permission to use the fonts names as presented to the user in modified versions?"{% endif %}>Build Font</button>
    </div>
  </div>

  {% endif %}

</form>

{% endblock %}


{% block extrajs %}

<script>
$(document).ready(function() {
    $('button[data-confirm]').click(function(ev) {

        var form = $(this).closest('form');

        if (!$('#dataConfirmModal').length) {
            $('body').append('<div id="dataConfirmModal" class="modal" role="dialog" aria-labelledby="dataConfirmLabel" aria-hidden="true"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h3 id="dataConfirmLabel">RFN Permission</h3></div><div class="modal-body"></div><div class="modal-footer"><button class="btn pull-left" data-dismiss="modal" aria-hidden="true">Cancel</button><a class="btn btn-success" id="dataConfirmYes">Yes</a><a class="btn btn-danger" id="dataConfirmNo">No</a></div></div>');
        } 
        $('#dataConfirmModal').find('.modal-body').text($(this).attr('data-confirm'));
        $('#dataConfirmYes').click(function(ev){
            form.submit();
        });
        $('#dataConfirmNo').click(function(ev){
          $('#reanme2').prop('checked',true);
          form.submit();
        });
        $('#dataConfirmModal').modal({show:true});
        return false;
    });
});
</script>


</div>
{% endblock %}

