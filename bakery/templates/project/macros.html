{% macro nav(active) -%}
  <h5>{{ project.clone }} 
  {% if g.debug %}
    <a class="pull-right" href="{{ url_for('project.bump', project_id = project.id )}}" data-confirm="Are you sure you want to pull from the upstream git repository?"><button class="btn btn-small" type="button"><i class="icon-chevron-up"></i> Pull &amp; rebuild</button></a>    
  {% endif %}
	</h5>
    <h2>{{ page_title }}</h2>
    <ul class="nav nav-tabs">
      <li {% if active == 'setup' %}class="active"{% endif %}><a href="{{ url_for('project.setup', project_id = project.id )}}">Setup</a></li>
      {% if project.config['local'].get('setup', None) %}
          <li {% if active == 'log' %}class="active" {% endif %}><a href="{{ url_for('project.buildlog', project_id=project.id ) }}" >Bake Log</a></li>
          <li {% if active == 'tests' %}class="active" {% endif %}><a href="{{ url_for('project.tests', project_id=project.id ) }}">Tests</a></li>
          <li class="dropdown {% if active in ['fonts', 'yaml', 'license', 'ace', 'description'] %}active{% endif %}">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                 Files <i class="caret"></i>
            </a>
            <ul class="dropdown-menu">
                <li class="nav-header">Folders</li>
          		<li {% if active == 'fonts' %}class="active" {% endif %}><a href="{{ url_for('project.fonts', project_id=project.id) }}">Browse</a></li>
                <li class="nav-header">Read Only Files</li>
                <li {% if active == 'yaml' %}class="active" {% endif %}><a href="{{ url_for('project.bakeryyaml', project_id=project.id ) }}" >bakery.yaml</a></li>
                <li {% if active == 'license' %}class="active" {% endif %}><a href="{{ url_for('project.plicense', project_id=project.id ) }}" >License</a></li>
                <li class="nav-header">Editable Files</li>
                <li {% if active == 'ace' %}class="active" {% endif %}><a href="{{ url_for('project.ace', project_id=project.id ) }}" >METADATA.json</a></li>
                <li {% if active == 'description' %}class="active" {% endif %}><a href="{{ url_for('project.description_edit', project_id=project.id ) }}" >DESCRIPTION.en_us.html</a></li>
            </ul>
          </li>
      {% endif %}
    </ul>

{%- endmacro %}

{% macro filestree(tree) %}
  <div class="tree">
    <ul>
      <li><a><i class="icon-folder-open"></i>Root</a></li>
      <ul>
      {%- for key, value in project.config['local']['tree'].items() recursive %}
        <li {%if key == 'glyphs' and value %} class="mother_of_glyphs" {% endif %} >
          <a>{% if key == '' %}
            Root
          {% else %}
            {%   if key.lower().endswith('.ufo') and value %}<i class="icon-font text-info"></i>
            {% elif key.lower().endswith('.otf') %}<i class="icon-file"></i>
            {% elif key.lower().endswith('.ttf') %}<i class="icon-file"></i>
            {% elif key.lower().split('.')[-1] in ['txt', 'md', 'mdown', 'markdown'] %}<i class="icon-book"></i>
            {% elif key.lower().split('.')[-1] in ['plist'] %}<i class="icon-list"></i>
            {% elif key in ['glyphs', 'ttf', 'otf', 'src', 'sources'] %}<i class="icon-folder-close"></i>
            {% elif key == 'bakery.yaml' %}<i class="icon-rocket text-error"></i>
            {% else %}<i class="icon-file-alt muted"></i>
            {%endif%}
            {{ key }}
          {% endif %}</a>
        {%- if value %}<ul {%if key == 'glyphs' %} class="glyphs" {% endif %}>{{ loop(value.items())}}</ul>{%- endif %}
        </li>
      {%- endfor %}
      </ul>
    </ul>
  </div>  
{% endmacro %}