{% extends "project/base.html" %}
{% set page_title = _("Edit METADATA.json") %}

{% block pnav %}
{% from 'project/macros.html' import nav with context%}
{{ nav('build') }}
{% endblock %}

{% block pbody %}
{% from 'project/macros.html' import subnav_build with context%}
{{ subnav_build('metadatajson') }}

{% if metadata_new and metadata %}
<div class="col-md-6">
  <h4>{{ _("METADATA.json imported from upstream repo") }}</h4>
  <pre><code>{{ metadata }}</code></pre>
</div>

<div class="col-md-6">
  <h4>{{ _("METADATA.json.new generated from files") }}</h4>
  <pre><code>{{ metadata_new }}</code></pre>
  <!-- <div style="margin-bottom: 12px;">
    <a class="btn btn-danger">
      <span>{{ _('Delete <code>METADATA.json.new</code>') }}</span>
    </a>
  </div> -->
</div>

<div id="diff"></div>
{% elif not metadata %}
<div class="col-md-12">
  <h4 class="text-danger">{{ _("METADATA.json does not yet exist") }}</h4>
  {{ metadata }}
</div>
{% else %}
<div class="col-md-12">
  <h4>{{ _("METADATA.json generated from files") }}</h4>
  {{ metadata }}
</div>
{% endif %}

{% endblock %}


{% block extrajs %}
{% if metadata_new and metadata %}
<script type="text/javascript" src="{{ url_for('static', filename='libs/jsondiffpatch/build/bundle.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='libs/jsondiffpatch/external/diff_match_patch_uncompressed.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='libs/jsondiffpatch/build/formatters.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='libs/jsondiffpatch/src/formatters/html.css') }}" type="text/css" />
<script>
$(document).ready(function () {
  var left = {{ metadata|safe or {} }};
  var right = {{ metadata_new|safe or {} }};

  var diffpatcher = jsondiffpatch.create();
  var delta = diffpatcher.diff(left, right);

  var visualdiff = document.getElementById('diff');
  if (visualdiff) {
    visualdiff.innerHTML = jsondiffpatch.formatters.html.format(delta, left);
  }
});
</script>
{% endif %}
{% endblock %}
