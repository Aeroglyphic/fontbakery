{# Dashboard for logged in user #}
{% extends 'base.html' %}
{% set page_title = _('Dashboard') %}

{% block body %}

<h2>{{ _("Dashboard") }}</h2>
<p>{{ _("List of available repositories.") }} <a href='{{ url_for('settings.repos') }}'><button class="btn btn-small">{{ _("Add some more!") }}</button></a></p></p>

<table class="table table-striped">
  <thead>
    <tr>
      <th>{{ _("Clone String") }}</th>
      <th>{{ _("Actions") }}</th>
    </tr>
  </thead>

  <tbody>
    {% for item in repos -%}
      <tr>
        <td><a href="{{ url_for('project.fonts', project_id = item.id )}}">{{item.clone}}</a>{% if item.homepage %}<a href="{{ item.homepage}} "><i class="icon-share"></i></a>{% endif %}</td>
        <td>{{ item.config }}
        {# 
            
            This set of ifs is duplicating the process_project() and sync_and_process() methods... perhaps there other parts of the overall build process that maybe aren't explicitly defined in code anywhere else, but, perhaps the item.config['local']['status'] key should be renamed item.config['local']['nextstep'] and the values should be descriptions of the next step required to build the repo, that can be used directly as the button text in this template? 

        #}
        {%   if item.config['local']['status']=='default' %}
            <a href="{{ url_for('project.fonts', project_id = item.id )}}" class="btn btn-mini">{{ _("Setup this repo now") }}</a>  
        {% elif item.config['local']['status']=='repo' %}
            
        {% elif item.config['local']['bakery_yaml_in_sync']=='False' %}
            <a href="{{ url_for('project.bakeryyaml', project_id = item.id )}}" class="btn btn-mini">{{ _("Add bakery.yaml to upstream repository") }}</a>
        {% elif item.config['local']['status']=='local' %}
            <a href="{{ url_for('project.setup', project_id = item.id )}}" class="btn btn-mini">{{ _("Build this repo now") }}</a>  
        {% else %} {#  equal to, if item.config['local']['status']=='built' # TODO make this state actually exist :) #}
            <span class="muted">{{ _("OK") }}</span>
        {% endif %}
        </td>
      </tr>
      <tr>
        <td colspan="2">
            {% if item.config['state']['source_drawing_filetype']=='VFB' %}
            <i class="icon-thumbs-down">VFB</i>
            {% else %}
            <i class="">No source</i>
            {% endif %}
        </td>
      </tr>

      {% if item.family_stat %}
      <tr>
        <td colspan="2">
        Total - {{ item.family_stat.total }} <br />
        Month - {{ item.family_stat.month }} <br />
        Week - {{ item.family_stat.week }} <br />
        Yesterday - {{ item.family_stat.yesterday }} <br /> 
        Rate - {{ item.family_stat.rate }} <br />
        </td>
      </tr>
      {% endif %}


    {% else %}
      <tr>
        <td colspan="2">
            <p class="muted lead" style="text-align: center; padding-top: 10px;">
              {{ _("List of available repositories is empty") }}. <br /><br />
              <a href='{{ url_for('settings.repos') }}'><button class="btn btn-primary">{{ _("Add some now") }}</button></a>
            </p>
        </td>
      </tr> 
    {%- endfor %}
  </tbody>
</table>

{% endblock %}
