{% extends "base.html" %}
{% set page_title = _("Add Repositories from Github") %}

{% block body %}
    <h2>{{ page_title }}</h2>

<div class="tabbable">

    <div class="alert alert-info">
        {{ _("When you click 'Add Repository,' Font Bakery will download the entire repository in the background.") }}
    </div>

  <ul class="nav nav-tabs">
    <li class="active"><a href="#massgithub" data-toggle="tab">{{ _("One Time") }}</a></li>
    <li><a href="#github" data-toggle="tab">{{ _("Subscribe") }}</a></li>
  </ul>

  <div class="tab-content">

    <div id="massgithub" class="tab-pane active">
      <form class="well well-small" action="{{ url_for('settings.update') }}" method="POST">
        {% if cache %}
          {{ _("List of GitHub repositories last updated") }} {{ cache.updated | pretty_date}}
          <button type="submit" class="btn btn btn-small pull-right">{{ _("Refresh") }}</button>
          {% else %}
          <button type="submit" class="btn btn-primary btn-small pull-right">{{ _("Refresh") }}</button>
        {% endif %}
      </form>

      <p>{{ _("Select repositories to add from your GitHub account") }}:</p>

        <form action="{{ url_for('settings.massgit') }}" method="POST">
          {% if cache %}
            {% for item in cache.data -%}
            <label class="checkbox" for="{{ item.full_name }}"><input id="{{ item.full_name }}" type="checkbox" {% if item.full_name in projects%}checked="checked"{%endif%} value="{{ item.full_name }}" name="git"> {{ item.full_name }}</label>
            {%- endfor %}
          {% else %}
            <p class="muted">{{ _("Click 'Refresh' to update this list.") }}</p>
          {% endif %}

          <button type="submit" class="btn btn-primary" data-confirm="{{ _('Does this repository contain only works you have permission to modify (because you are the owner or it is licensed with an Open Source license)?') }}">{{ _("Add repositories") }}</button>
        </form>

    </div>

    <div id="github" class="tab-pane ">
      <form class="well well-small" action="{{ url_for('settings.update') }}" method="POST">
        {% if cache %}
          List of GitHub repositories last updated {{ cache.updated | pretty_date}}
          <button type="submit" class="btn btn btn-small pull-right">Refresh</button>
          {% else %}
          <button type="submit" class="btn btn btn-primary pull-right">Refresh</button>
        {% endif %}
      </form>

      <p>To add repositories from GitHub with webhooks to get updates when a repo is updated, click a <a class="btn btn-mini"><i class="icon-star-empty"></i></a></p>

      <table class="table table-striped table-condensed">
        <thead>
          <tr>
            <th><i class="icon-star-empty"></i></th>
            <th>Repository</th>
            <th>Description</th>
            <th>Settings</th>
          </tr>
        </thead>

        <tbody>
          {% if cache %}
            {% for item in cache.data -%}
              <tr {% if item.full_name in projects%} class="success" {% endif %}>
                <td>{% if item.full_name in projects %}<a href="{{ url_for('settings.delhook', full_name=item.full_name) }}"><i class="icon-star"></i></a>{% else %}<a href="{{ url_for('settings.addhook', full_name=item.full_name) }}" data-confirm="Does this repository contain only works you have permission to modify (because you are the owner or it is licensed with an Open Source license)?"><i class="icon-star-empty"></i></a>{% endif %}</td>
                <td>{{ item.full_name }} {% if item.homepage %}<a href="{{ item.homepage}} "><i class="icon-share"></i></a>{% endif %}</td>
                <td>{% if item.description %}{{ item.description | truncate(length=80)}}{% endif %}</td>
                <td><a href="{{ item.html_url }}/settings/hooks" class="btn"><i class="icon-wrench"></i> </a></td>
              </tr>
            {%- endfor %}
          {% else %}
          <tr>
              <td colspan="4">
                  <p class="muted">Click 'Refresh' to update this list.</p>
              </td>
          </tr> 
          {% endif %}
        </tbody>
      </table>

    </div>

  </div><!-- /.tab-content -->
</div><!-- /.tabbable -->
{% endblock %}

{% block extrajs %}
<script type="text/javascript">
// Javascript to enable link to tab
var hash = document.location.hash;
var prefix = "tab_";
if (hash) {
    $('.nav-tabs a[href='+hash.replace(prefix,"")+']').tab('show');
} 
// Change hash for page-reload
$('.nav-tabs a').on('shown', function (e) {
    window.location.hash = e.target.hash.replace("#", "#" + prefix);
});
</script>
{% endblock %}
