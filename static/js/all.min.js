(function(window,angular,undefined){"use strict";angular.module("ngQueue",[]).factory("$queue",["$timeout",function($timeout){var defaults={delay:100,complete:null,paused:false};function Queue(callback,options){options=angular.extend({},defaults,options);if(!angular.isFunction(callback)){throw new Error("callback must be a function")}var cleared=false,timeoutProm=null;this.queue=[];this.delay=options.delay;this.callback=callback;this.complete=options.complete;this.paused=options.paused;var stop=function(){if(timeoutProm){$timeout.cancel(timeoutProm)}timeoutProm=null};this.size=function(){return this.queue.length};this.add=function(item){return this.addEach([item])};this.addEach=function(items){if(items){cleared=false;this.queue=this.queue.concat(items)}if(!this.paused){this.start()}return this.size()};this.clear=function(){var orig=this.queue;stop();this.queue=[];cleared=true;return orig};this.pause=function(){stop();this.paused=true};this.start=function(){var _this=this;this.paused=false;if(this.size()&&!timeoutProm){(function loopy(){var item;stop();if(_this.paused)return;if(!_this.size()){cleared=true;if(angular.isFunction(_this.complete)){_this.complete.call(_this)}return}item=_this.queue.shift();_this.callback.call(_this,item);timeoutProm=$timeout(loopy,_this.delay);return})()}};this.indexOf=function(item){if(this.queue.indexOf)return this.queue.indexOf(item);for(var i=0;i<this.queue.length;i++){if(item===this.queue[i])return i}return-1};this.unset=function(value){if(this.indexOf(value)!=-1){this.queue.splice(this.indexOf(value),1)}}}Queue.queue=function(callback,options){return new Queue(callback,options)};return Queue}])})(window,window.angular);(function(){"use strict";angular.module("http-throttler",["http-interceptor-buffer"]).factory("httpThrottler",["$q","$log","httpBuffer",function($q,$log,httpBuffer){var reqCount,service;reqCount=0;service={request:function(config){var deferred;if(reqCount>=30){$log.warn("Too many requests");deferred=$q.defer();httpBuffer.append(config,deferred);return deferred.promise}else{reqCount++;return config||$q.when(config)}},requestError:function(rejection){reqCount++;return $q.reject(rejection)},responseError:function(rejection){reqCount--;httpBuffer.retryOne();return $q.reject(rejection)},response:function(response){reqCount--;httpBuffer.retryOne();return response||$q.when(response)}};return service}]);angular.module("http-interceptor-buffer",[]).factory("httpBuffer",["$log",function($log){var buffer,retryHttpRequest,service;buffer=[];retryHttpRequest=function(config,deferred){if(config!=null){return deferred.resolve(config)}};service={append:function(config,deferred){return buffer.push({config:config,deferred:deferred})},retryOne:function(){var req;if(buffer.length>0){req=buffer.pop();return retryHttpRequest(req.config,req.deferred)}}};return service}])}).call(this);var myApp=angular.module("myApp",["ngRoute","ui.bootstrap","ui.ace","googlechart","ngTable","ngSanitize","routeStyles","angularMoment","http-throttler","ngStorage","ngQueue"]);myApp.constant("appConfig",{base_url:"//rawgit.com",base_url_no_cdn:"//rawgit.com",git_modules_url:"//rawgit.com/fontdirectory/collection/master/gitmodules.json",data_dir:"data",pages_dir:"pages",app:"build_info.json",repo:"repo.json",metadata:"METADATA.json",metadata_new:"METADATA.new.json",statusMap:{success:"OK",failure:"FAIL",error:"ERROR",fixed:"FIXED"},resultMap:{success:"success",failure:"danger",error:"warning",fixed:"info"},fontWeightMap:{100:"Thin",200:"ExtraLight",300:"Light",400:"",500:"Medium",600:"SemiBold",700:"Bold",800:"ExtraBold",900:"Black"},pangram:"Grumpy wizards make toxic brew for the evil Queen and Jack."});myApp.factory("httpInterceptor",["$q","$location","alertsFactory",function($q,$location,alertsFactory){var _config={};return{request:function(config){_config=config||$q.when(config);return _config},requestError:function(rejection){return $q.reject(rejection)},response:function(response){return response||$q.when(response)},responseError:function(rejection){if(!_config.nointercept){alertsFactory.addAlert(rejection.status+" - "+rejection.statusText+": "+_config.url)}return $q.reject(rejection)}}}]);myApp.config(["$routeProvider","$httpProvider","$locationProvider","appConfig",function($routeProvider,$httpProvider,$locationProvider,appConfig){$routeProvider.when("/",{controller:"reposController",title:"Repos list",templateUrl:"pages/repos_list.html",activetab:"repos"}).when("/:repo_owner/:repo_name/",{title:"Summary",templateUrl:"pages/summary.html",controller:"summaryController",activetab:"summary",css:function(params){var links=["/static/css/tablesorter-theme-custom.css"];if(params.repo_name){var faces=[appConfig.base_url_no_cdn,params.repo_owner,params.repo_name,"gh-pages/build_info/static/css/faces.css"].join("/");links.push(faces)}return links}}).when("/:repo_owner/:repo_name/review",{title:"Review - Web Fonts",templateUrl:"pages/review-web-fonts.html",controller:"reviewWebFontsController",activetab:"review_fonts",css:function(params){var links=["static/css/pages/review.css","static/css/pages/opentype.css"];if(params.repo_name){var faces=[appConfig.base_url_no_cdn,params.repo_owner,params.repo_name,"gh-pages/build_info/static/css/faces.css"].join("/");links.push(faces)}return links}}).when("/:repo_owner/:repo_name/review/glyph-inspector",{title:"Review - Glyph Inspector",templateUrl:"pages/review-glyph-inspector.html",controller:"reviewGlyphInspectorController",activetab:"review_fonts",css:function(params){var links=["static/css/pages/review.css","static/css/pages/opentype.css"];if(params.repo_name){var faces=[appConfig.base_url_no_cdn,params.repo_owner,params.repo_name,"gh-pages/build_info/static/css/faces.css"].join("/");links.push(faces)}return links}}).when("/:repo_owner/:repo_name/checks",{title:"Pre-Build Checks",templateUrl:"pages/checks.html",controller:"checksController",activetab:"checks"}).when("/:repo_owner/:repo_name/tests",{title:"Tests",templateUrl:"pages/tests.html",controller:"testsController",activetab:"tests"}).when("/:repo_owner/:repo_name/log",{title:"Build Log",templateUrl:"pages/log.html",controller:"logController",activetab:"log",css:"static/css/pages/log.css"}).when("/:repo_owner/:repo_name/metadata",{title:"Metadata",templateUrl:"pages/metadata.html",controller:"metadataController",activetab:"metadata",css:"static/css/libs/jsondiffpatch/html.css"}).when("/:repo_owner/:repo_name/setup",{title:"Setup",templateUrl:"pages/setup.html",controller:"setupController",activetab:"setup"}).when("/:repo_owner/:repo_name/description",{title:"Description",templateUrl:"pages/description.html",controller:"descriptionController",activetab:"description",css:"static/css/libs/jsondiffpatch/html.css"}).otherwise({redirectTo:"/"});$httpProvider.defaults.cache=true;$httpProvider.interceptors.push("httpThrottler");$httpProvider.interceptors.push("httpInterceptor")}]);myApp.run(["$location","$rootScope",function($location,$rootScope){$rootScope.$on("$routeChangeSuccess",function(event,current,previous){$rootScope.title=current.$$route.title;$rootScope.current_template=current.$$route.templateUrl;$rootScope.activetab=current.$$route.activetab})}]);myApp.factory("alertsFactory",[function(){var alerts=[];return{getAlerts:function(){return alerts},addAlert:function(msg,type){alerts.push({msg:msg,type:type||"danger"})},closeAlert:function(index){alerts.splice(index,1)}}}]);google.load("visualization","1",{packages:["corechart"]});function isElementInViewport(el){if(typeof jQuery==="function"&&el instanceof jQuery){el=el[0]}var rect=el.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}angular.module("myApp").directive("navMenu",["$location",function($location){function activeLink(scope,element,attrs){var links=element.find("a"),activeClass=attrs.navMenu||"active",routePattern,link,url,currentLink,urlMap={},i;if(!$location.$$html5){routePattern=/^#[^/]*/}for(i=0;i<links.length;i++){link=angular.element(links[i]);url=link.attr("href");if($location.$$html5){urlMap[url]=link}else{urlMap[url.replace(routePattern,"")]=link}}scope.$on("$routeChangeStart",function(){var pathLink=urlMap[$location.path()];if(pathLink){if(currentLink){currentLink.parent("li").removeClass(activeClass)}currentLink=pathLink;currentLink.parent("li").addClass(activeClass)}})}return{link:activeLink}}]);angular.module("myApp").directive("insertGlyph",["$compile",function($compile){var getTemplate=function(is_missing){return is_missing?'<div style="display: none;"><span class="defaultCharacter">{{ glyph_decoded }}</span><span class="missing-glyph">X</span></div>':"<div ng-style=\"{'font-family': font_regular.postScriptName, 'font-style': font_regular.style}\"><span class=\"defaultCharacter\">{{ glyph_decoded }}</span><span>{{ glyph_decoded }}</span></div>"};return{restrict:"A",link:function(scope,element,attrs){var el=$compile(getTemplate(scope.is_missing))(scope);element.replaceWith(el)}}}]);angular.module("myApp").directive("getBuildInfo",["$compile","$window","$rootScope",function($compile,$window,$rootScope){return{restrict:"A",link:function(scope,element,attrs){var isResolved="buildIsResolved";var eventsListener;if(!scope.build.hasOwnProperty(isResolved)){eventsListener=$rootScope.$watch("repo_selected",function(){if(isElementInViewport(element)&&!scope.build.hasOwnProperty(isResolved)){scope.build.getBuildInfoCallback(scope)}},true)}if(scope.build.hasOwnProperty(isResolved)){if(angular.isFunction(eventsListener)){eventsListener()}if(scope.build[isResolved]){$rootScope.itemsQueue.build.unset(scope.build)}}}}}]);angular.module("myApp").directive("getTestsInfo",["$compile","$window","$rootScope",function($compile,$window,$rootScope){return{restrict:"A",link:function(scope,element,attrs){var isResolved="testsIsResolved";var eventsListener;if(!scope.build.hasOwnProperty(isResolved)){eventsListener=$rootScope.$watch("repo_selected",function(){if(isElementInViewport(element)&&!scope.build.hasOwnProperty(isResolved)){scope.build.getTestsInfoCallback(scope)}})}if(scope.build.hasOwnProperty(isResolved)){if(angular.isFunction(eventsListener)){eventsListener()}if(scope.build[isResolved]){$rootScope.itemsQueue.tests.unset(scope.build)}}}}}]);angular.module("myApp").directive("loadingContainer",function(){return{restrict:"A",scope:false,link:function(scope,element,attrs){var loadingLayer=angular.element('<div class="loading"></div>');element.append(loadingLayer);element.addClass("loading-container");scope.$watch(attrs.loadingContainer,function(value){loadingLayer.toggleClass("ng-hide",!value)})}}});angular.module("myApp").directive("applySorting",["$timeout",function($timeout){return{link:function(scope,element,attrs){var resort=true,callback=function(table){},config={};element.tablesorter();if(attrs.applySorting){if(angular.isFunction(attrs.applySorting)){config=attrs.applySorting(element)}callback=function(table){element.tablesorter(config)}}$timeout(function(){element.trigger("updateAll",[resort,callback])},2e3)}}}]);angular.module("myApp").directive("transposeTable",["$timeout",function($timeout){return{replace:true,link:function(scope,element,attr){var arrows='<span class="pull-right"><i class="fa fa-caret-left"></i> <i class="fa fa-caret-right"></i></span>',arrow_left='<span class="pull-right"><i class="fa fa-caret-left"></i></span>',arrow_right='<span class="pull-right"><i class="fa fa-caret-right"></i></span>',sorting_attr="data-sorting",td_class_locator="fixed-col",hidden_class_locator=".hidden",fixed_td_locator="td."+td_class_locator,asc="asc",dsc="dsc";function getDirection(direction){return direction===asc?{asc:1,dsc:-1}:{asc:-1,dsc:1}}function toggleDirection(td){element.find(fixed_td_locator).find("span").remove();element.find(fixed_td_locator).append(arrows);$(td).find("span").remove();if($(td).attr(sorting_attr)===asc){$(td).attr(sorting_attr,dsc);$(td).append(arrow_right)}else{$(td).attr(sorting_attr,asc);$(td).append(arrow_left)}}function sortTableCols(row_num,compare_by,direction){var drc=getDirection(direction);var rows=element.find("tr");var vals=[];var tds=rows.eq(row_num).find("td").not("."+td_class_locator);angular.forEach(tds,function(td){vals.push(td[compare_by])});var filtered=vals.sort();tds.sort(function(a,b){return filtered.indexOf($.text([a]))>filtered.indexOf($.text([b]))?drc.asc:drc.dsc}).each(function(new_Index){var original_Index=$(this).index();rows.each(function(){var th=$(this).find("th");if(original_Index!==new_Index)th.eq(original_Index).insertAfter(th.eq(new_Index))});rows.each(function(){var td=$(this).find("td");if(original_Index!==new_Index)td.eq(original_Index).insertAfter(td.eq(new_Index))})});return false}$(element).find(attr.transposeTable).on("click",function(){element.trigger("destroy");element.find(fixed_td_locator).find("span").remove();element.find("thead tr").detach().prependTo(element.find("tbody"));var t=element.find("tbody").eq(0);var r=t.find("tr");var cols=r.length;var rows=r.eq(0).find("td,th").not(hidden_class_locator).length;var cell,next,tem,i=0;var tb=$("<tbody></tbody>");while(i<rows){cell=0;tem=$("<tr></tr>");while(cell<cols){next=r.eq(cell++).find("td,th").not(hidden_class_locator).eq(0);tem.append(next)}tb.append(tem);++i}element.find("tbody").remove();$(tb).appendTo(element);element.find("tbody tr:eq(0)").detach().appendTo(element.find("thead")).children().each(function(){$(this).replaceWith('<th scope="col">'+$(this).html()+"</th>")});element.find("tbody tr th:first-child").each(function(){$(this).replaceWith('<td class="'+td_class_locator+'" scope="row" '+sorting_attr+'="'+asc+'">'+$(this).html()+"</td>")});element.show();element.trigger("destroy");element.tablesorter();element.trigger("updateAll",[true]);element.find(fixed_td_locator).append(arrows);element.find(fixed_td_locator).on("click",function(){toggleDirection(this);var colIndex=$(this).index();var trIndex=$(this).closest("tr").index();sortTableCols(trIndex+1,"outerText",$(this).attr(sorting_attr))})});element.find(fixed_td_locator).on("click",function(){toggleDirection(this);var colIndex=$(this).index();var trIndex=$(this).closest("tr").index();sortTableCols(trIndex+1,"outerText",$(this).attr(sorting_attr))});$timeout(function(){element.find(fixed_td_locator).on("click",function(){toggleDirection(this);var colIndex=$(this).index();var trIndex=$(this).closest("tr").index();sortTableCols(trIndex+1,"outerText",$(this).attr(sorting_attr))})},5e3)}}}]);angular.module("myApp").filter("replace",[function(){return function(target,arg1,arg2){return target.split(arg1).join(arg2)}}]);angular.module("myApp").filter("default",["$filter",function($filter){return function(input,defaultValue){if(!input)return defaultValue;return input}}]);angular.module("myApp").service("Mixins",[function(){this.checkAll=function(){var compare_to=arguments[0];function boolFilter(element,index,array){return element===compare_to}var args=Array.prototype.slice.call(arguments,1);return args.every(boolFilter)};this.decodeHtmlEntity=function(str){return str.replace(/&#(\d+);/g,function(match,dec){return String.fromCharCode(dec)})};this.updateChartTitle=function(title,attrs){$("svg > g > text:contains("+title+")").attr(attrs||{x:50})};this.encodeHtmlEntity=function(str){var buf=[];for(var i=str.length-1;i>=0;i--){buf.unshift(["&#",str[i].charCodeAt(),";"].join(""))}return buf.join("")}}]);angular.module("myApp").service("PathBuilder",["appConfig",function(appConfig){this._repo={owner:null,name:null};this.buildPath=function(){var args=[];angular.forEach(arguments,function(item){args.push(item)});return args.join("/")};this.buildDataPath=function(){var args=[appConfig.data_dir];angular.forEach(arguments,function(item){args.push(item)});return args.join("/")};this.buildPagesPath=function(){var args=[appConfig.data_dir,appConfig.pages_dir];angular.forEach(arguments,function(item){args.push(item)});return args.join("/")};this.buildGhPagesUrl=function(){var args=[appConfig.base_url,this._repo.owner,this._repo.name,"gh-pages"];angular.forEach(arguments,function(item){args.push(item)});return args.join("/")};this.buildDataUrl=function(){var args=[appConfig.base_url,this._repo.owner,this._repo.name,"gh-pages","build_info",appConfig.data_dir];angular.forEach(arguments,function(item){args.push(item)});return args.join("/")};this.buildPagesUrl=function(){var args=[appConfig.base_url,this._repo.owner,this._repo.name,"gh-pages","build_info",appConfig.data_dir,appConfig.pages_dir];angular.forEach(arguments,function(item){args.push(item)});return args.join("/")};this.buildTravisUrl=function(){return["https://api.travis-ci.org/repos",this._repo.owner,this._repo.name].join("/")}}]);angular.module("myApp").service("appApi",["$http","$q","PathBuilder","appConfig",function($http,$q,PathBuilder,appConfig){this.setActiveRepo=function(repo){PathBuilder._repo=repo};this.getAppInfo=function(){return $http.get(PathBuilder.buildDataUrl(appConfig.app))};this.getRepoInfo=function(){return $http.get(PathBuilder.buildDataUrl(appConfig.repo))};this.getMetadata=function(){return $http.get(PathBuilder.buildGhPagesUrl(appConfig.metadata))};this.getMetadataNew=function(){return $http.get(PathBuilder.buildGhPagesUrl(appConfig.metadata_new))};this.getRepos=function(){return $http.get(appConfig.git_modules_url)};this.checkRepo=function(repo){var url=[appConfig.base_url,repo.owner,repo.name,"gh-pages",appConfig.metadata].join("/");return $http.get(url)};this.getRepoBuildInfo=function(){return $http.get(PathBuilder.buildTravisUrl(),{headers:{Accept:"application/vnd.travis-ci.2+json"}})}}]);angular.module("myApp").service("reposApi",["$http","$q","appConfig",function($http,$q,appConfig){this.getRepos=function(){return $http.get(appConfig.git_modules_url)};this.getCollection=function(access_token){return $http.get("https://api.github.com/repos/fontdirectory/collection/git/trees/HEAD",{params:{access_token:access_token,recursive:1}})}}]);angular.module("myApp").service("metadataApi",["$http","$q","PathBuilder","appConfig",function($http,$q,PathBuilder,appConfig){var name="metadata";this.getMetadata=function(){return $http.get(PathBuilder.buildGhPagesUrl(appConfig.metadata))};this.getMetadataNew=function(){return $http.get(PathBuilder.buildGhPagesUrl(appConfig.metadata_new))};this.getMetadataRaw=function(){return $http.get(PathBuilder.buildGhPagesUrl(appConfig.metadata),{transformResponse:[]})};this.getMetadataNewRaw=function(){return $http.get(PathBuilder.buildGhPagesUrl(appConfig.metadata_new),{transformResponse:[]})};this.getRawFiles=function(urls_list){var urls=urls_list||[{url:PathBuilder.buildGhPagesUrl(appConfig.metadata)},{url:PathBuilder.buildGhPagesUrl(appConfig.metadata_new)}];var deferred=$q.defer();var urlCalls=[];angular.forEach(urls,function(url){urlCalls.push($http.get(url.url,{transformResponse:[]}))});$q.all(urlCalls).then(function(results){deferred.resolve(results)},function(errors){deferred.reject(errors)},function(updates){deferred.update(updates)});return deferred.promise};this.getTests=function(){return $http.get(PathBuilder.buildPagesUrl(name,"tests.json"))}}]);angular.module("myApp").service("testsApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="tests";this.getTests=function(){return $http.get(PathBuilder.buildPagesUrl(name,"tests.json"))}}]);angular.module("myApp").service("summaryApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="summary";this.getMetrics=function(){return $http.get(PathBuilder.buildPagesUrl(name,"metrics.json"))};this.getTableSizes=function(){return $http.get(PathBuilder.buildPagesUrl(name,"table_sizes.json"))};this.getAutohintSizes=function(){return $http.get(PathBuilder.buildPagesUrl(name,"autohint_sizes.json"))};this.getFontaineFonts=function(){return $http.get(PathBuilder.buildPagesUrl(name,"fontaine_fonts.json"))};this.getFontsOrthography=function(){return $http.get(PathBuilder.buildPagesUrl(name,"fonts_orthography.json"))};this.getTests=function(){return $http.get(PathBuilder.buildPagesUrl(name,"tests.json"))};this.getFontsTableGrouped=function(){return $http.get(PathBuilder.buildPagesUrl(name,"fonts_tables_grouped.json"))}}]);angular.module("myApp").service("checksApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="checks";this.getTests=function(){return $http.get(PathBuilder.buildPagesUrl(name,"tests.json"))};this.getUpstreamYamlFile=function(){return $http.get(PathBuilder.buildPagesUrl(name,"upstream.yaml"))}}]);angular.module("myApp").service("buildApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="build";this.getBuildLog=function(){return $http.get(PathBuilder.buildPagesUrl(name,"buildlog.html"),{transformResponse:[]})}}]);angular.module("myApp").service("bakeryYamlApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="bakery-yaml";this.getYamlFile=function(){return $http.get(PathBuilder.buildPagesUrl(name,"bakery_yaml.json"),{transformResponse:[]})}}]);angular.module("myApp").service("descriptionApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="description";this.getDescriptionFile=function(){return $http.get(PathBuilder.buildPagesUrl(name,"DESCRIPTION.en_us.html"),{transformResponse:[]})}}]);angular.module("myApp").service("reviewApi",["$http","$q","PathBuilder",function($http,$q,PathBuilder){var name="review";this.getOrthography=function(){return $http.get(PathBuilder.buildPagesUrl(name,"orthography.json"))}}]);angular.module("myApp").service("githubService",["$q","$location","$localStorage","$sessionStorage",function($q,$location,$localStorage,$sessionStorage){var $storage=$sessionStorage.$default({OAuth_result:{access_token:null,token_type:null},OAuth_error:null,OAuth_passed:false,OAuth_redirect_done:false});this.initializeOAuth=function(){OAuth.initialize("ZapNqQn-kP45Mq8tXYZi0u_G9bc",{cache:true});$storage.OAuth_result=OAuth.create("github",{access_token:$storage.OAuth_result.access_token,token_type:$storage.OAuth_result.token_type})};this.isReadyOAuth=function(){return $storage.OAuth_result.access_token};this.connectOAuth=function(){var deferred=$q.defer();var promise=OAuth.callback("github");if(promise){promise.done(function(result){deferred.resolve();$storage.OAuth_result=result;$storage.OAuth_error=null;$storage.OAuth_passed=true;$storage.OAuth_redirect_done=false});promise.fail(function(error){$storage.OAuth_result={access_token:null,token_type:null};$storage.OAuth_error=error;$storage.OAuth_passed=false;$storage.OAuth_redirect_done=false})}else{$storage.OAuth_redirect_done=true;OAuth.redirect("github",{cache:true},"#"+$location.path())}return deferred.promise};this.resetOAuth=function(){OAuth.clearCache("github");$storage.OAuth_result={access_token:null,token_type:null};$storage.OAuth_error=null;$storage.OAuth_passed=false;$storage.OAuth_redirect_done=false}}]);angular.module("myApp").controller("mainController",["$scope","$rootScope","$http","$window","$routeParams","$route","$location","$filter","$localStorage","$sessionStorage","appApi","alertsFactory","appConfig","Mixins","githubService",function($scope,$rootScope,$http,$window,$routeParams,$route,$location,$filter,$localStorage,$sessionStorage,appApi,alertsFactory,appConfig,Mixins,githubService){$scope.$storage=$sessionStorage;githubService.initializeOAuth();$scope.alerts=alertsFactory;$scope.mixins=Mixins;$scope.config=appConfig;$scope.statusMap=appConfig.statusMap;$scope.resultMap=appConfig.resultMap;$scope.pangram=appConfig.pangram;$scope.repos_list=null;$scope.app_info=null;$scope.repo_info=null;$scope.build_info=null;$rootScope.metadata=null;$scope.repo_is_valid=false;$scope.repo_current=null;$rootScope.repo_selected={name:null};$scope.initDone=function(){return $rootScope.metadata!=null&&$scope.repos_list!=null&&$scope.app_info!=null&&$scope.repo_info!=null&&$scope.build_info!=null&&$scope.repo_current!=null};$scope.isNormalFlow=function(){if($scope.$storage.OAuth_passed&&$scope.isRoot()){return true}if($scope.initDone()&&$scope.$storage.OAuth_passed){return true}if($scope.initDone()){if($scope.app_info.build_passed||!$scope.repo_is_valid){return true}}return false};$scope.filterWithQuicksilverRanking=function(val1,val2){try{if(!val2){return true}return val1.score(val2)>.3}catch(e){return false}};$scope.filterReposList=function(criteria){return function(item){return $scope.filterWithQuicksilverRanking(item.submodule,criteria)}};$scope.isRoot=function(){return $location.path()=="/"};$scope.onRepoSelect=function($item,$model,$label){var loc_path=$location.path(),hash_tag="#";if(loc_path=="/"){$window.location.href=[hash_tag,"fontdirectory",$item.submodule].join("/")}else{var parts=loc_path.split("/");parts[0]=hash_tag;parts[1]="fontdirectory";parts[2]=$item.submodule;$window.location.href=parts.join("/")}$window.location.reload();if($rootScope.metadata){$rootScope.repo_selected.name=$rootScope.metadata.name}};$scope.getMainFont=function(){var filtered=$rootScope.metadata.fonts.filter(function(font){return font.style=="normal"&&font.weight==400});if(filtered.length>0){$rootScope.font_regular=filtered[0]}else{$rootScope.font_regular=$rootScope.metadata.fonts[0]}return $rootScope.font_regular};$scope.getRepoTravisLink=function(){return["http://travis-ci.org",$scope.repo_current.owner,$scope.repo_current.name].join("/")};$scope.getRepoTravisImageLink=function(){return["https://travis-ci.org",$scope.repo_current.owner,$scope.repo_current.name+".svg"].join("/")};$scope.mainInit=function(){appApi.getRepos().then(function(dataResponse){$scope.repos_list=dataResponse.data;if($scope.repo_current.name===null||$scope.repo_current.name===undefined||$scope.repo_current.owner===null||$scope.repo_current.owner===undefined){$scope.repo_is_valid=false}else{appApi.checkRepo($scope.repo_current).then(function(dataResponse){$scope.repo_is_valid=true;appApi.setActiveRepo($scope.repo_current);appApi.getAppInfo().then(function(dataResponse){$scope.app_info=dataResponse.data});appApi.getRepoInfo().then(function(dataResponse){$scope.repo_info=dataResponse.data});appApi.getRepoBuildInfo().then(function(dataResponse){$scope.build_info=dataResponse.data});appApi.getMetadata().then(function(dataResponse){$rootScope.metadata=dataResponse.data;$rootScope.repo_selected.name=$rootScope.metadata.name;$scope.getMainFont()},function(error){appApi.getMetadataNew().then(function(dataResponse){$rootScope.metadata=dataResponse.data;$rootScope.repo_selected.name=$rootScope.metadata.name;$scope.getMainFont()})})},function(error){$scope.repo_is_valid=false;if($location.path()!="/"){$window.location.href="/"}})}})};$scope.authenticateWithOAuth=function(){githubService.connectOAuth().then(function(){if($scope.$storage.OAuth_passed){$scope.mainInit()}else{$scope.alerts.addAlert($scope.$storage.OAuth_error)}})};$scope.$on("$routeChangeSuccess",function(){$scope.repo_current={owner:$routeParams.repo_owner,name:$routeParams.repo_name};if($scope.$storage.OAuth_passed){$scope.mainInit()}else{if($scope.$storage.OAuth_redirect_done){$scope.authenticateWithOAuth()}}})}]);myApp.controller("setupController",["$scope","$http","bakeryYamlApi","PathBuilder",function($scope,$http,bakeryYamlApi,PathBuilder){$scope.dataLoaded=false;bakeryYamlApi.getYamlFile().then(function(response){$scope.data=response.data;$scope.dataLoaded=true});$scope.aceLoaded=function(_editor){};$scope.aceChanged=function(_editor){};$scope.view_url=PathBuilder.buildPath($scope.repo_info.url,"blob","master","bakery.yaml");$scope.edit_url=PathBuilder.buildPath($scope.repo_info.url,"edit","master","bakery.yaml")}]);angular.module("myApp").controller("logController",["$scope","$http","buildApi",function($scope,$http,buildApi){$scope.dataLoaded=false;buildApi.getBuildLog().then(function(response){$scope.data=response.data;$scope.dataLoaded=true})}]);myApp.controller("checksController",["$scope","$http","$filter","PathBuilder","checksApi","ngTableParams",function($scope,$http,$filter,PathBuilder,checksApi,ngTableParams){$scope.charts=[];$scope.average_chart=null;$scope.dataLoaded=false;checksApi.getTests().then(function(response){$scope.tests=response.data;$scope.dataLoaded=true;var data=[];angular.forEach($scope.tests,function(test){angular.forEach($scope.resultMap,function(result_val,result_key){angular.forEach(test[result_key],function(test_obj){var item={font:test.name,orig_data:test_obj,categories:test_obj.tags.join(", "),description:test_obj.methodDoc,result_msg:test_obj.err_msg,result_status:$scope.statusMap[result_key],result_class:result_val,gh_link:PathBuilder.buildPath($scope.repo_info.fontbakery.master_url,$filter("replace")(test_obj.name,".","/")+".py")};data.push(item)})})});$scope.testsTableParams=new ngTableParams({page:1,count:data.length,sorting:{result_status:"asc"}},{counts:[],total:data.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")(data,params.orderBy()):data;params.total(orderedData.length);$defer.resolve(orderedData)}});var chartsum={success:0,failure:0,fixed:0,error:0};angular.forEach($scope.tests,function(test){var success_len=test["success"].length,fixed_len=test["fixed"].length,failure_len=test["failure"].length,error_len=test["error"].length,gdata=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]),options={title:test.name,is3D:true,chartArea:{width:"100%"},colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.charts.push({data:gdata,options:options,type:"PieChart",displayed:true});chartsum={success:chartsum.success+success_len,error:error_len,failure:chartsum.failure+failure_len,fixed:chartsum.fixed+fixed_len}});var filtered=$filter("filter")($scope.charts,function(chart,index){return chart.options.title=="Project"});if(filtered!=[]){angular.forEach(filtered,function(item){$scope.charts.splice($scope.charts.indexOf(item),1);$scope.charts.unshift(item)})}if($scope.tests.length>1){var success_len=chartsum.success,fixed_len=chartsum.fixed,failure_len=chartsum.failure,error_len=chartsum.error,gdata=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]),options={title:"Average",is3D:true,chartArea:{width:"100%"},colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.average_chart={data:gdata,options:options,type:"PieChart",displayed:true}}})}]);angular.module("myApp").controller("descriptionController",["$scope","descriptionApi",function($scope,descriptionApi){$scope.dataLoaded=false;descriptionApi.getDescriptionFile().then(function(response){$scope.data=response.data;$scope.dataLoaded=true});$scope.aceLoaded=function(_editor){$scope.editor=_editor;$scope.data=$scope.editor.getSession().getValue()};$scope.aceChanged=function(_editor){$scope.data=$scope.editor.getSession().getValue()}}]);angular.module("myApp").controller("metadataController",["$scope","$http","$q","$filter","metadataApi","PathBuilder","appConfig","ngTableParams",function($scope,$http,$q,$filter,metadataApi,PathBuilder,appConfig,ngTableParams){$scope.charts=[];$scope.dataLoaded=false;$scope.editor1=null;$scope.editor2=null;$scope.view_url=PathBuilder.buildPath($scope.repo_info.url,"blob","master",appConfig.metadata);$scope.edit_url=PathBuilder.buildPath($scope.repo_info.url,"edit","master",appConfig.metadata);var doDiff=function(editor1,editor2,result_of_diff){return function(){try{var left=JSON.parse(editor1.getValue());var right=JSON.parse(editor2.getValue());var instance=jsondiffpatch.create({objectHash:function(obj){return""}});var delta=instance.diff(left,right);var visualdiff=document.getElementById(result_of_diff);if(visualdiff){visualdiff.innerHTML=jsondiffpatch.formatters.html.format(delta,left);var scripts=visualdiff.querySelectorAll("script");for(var i=0;i<scripts.length;i++){var s=scripts[i];
eval(s.innerHTML)}}if(!delta){$scope.alerts.addAlert("Two files are equal.","info")}angular.element(visualdiff).find("div").first().find("pre").each(function(i){angular.element(this).css("background-color","transparent").css("border","0")})}catch(e){$scope.alerts.addAlert(e.name+": "+e.message)}}};$scope.$watch("dataLoaded",function(){if($scope.dataLoaded){if($scope.editor1&&$scope.editor2){$scope.doDiff=doDiff($scope.editor1.getSession(),$scope.editor2.getSession(),"visualdiff")}}});metadataApi.getTests().then(function(response){$scope.tests=response.data;var data=[];angular.forEach($scope.tests,function(test){angular.forEach($scope.resultMap,function(result_val,result_key){angular.forEach(test[result_key],function(test_obj){var item={font:test.name,orig_data:test_obj,categories:test_obj.tags.join(", "),description:test_obj.methodDoc,result_msg:test_obj.err_msg,result_status:$scope.statusMap[result_key],result_class:result_val};data.push(item)})})});$scope.testsTableParams=new ngTableParams({page:1,count:data.length,sorting:{result_status:"asc"}},{counts:[],total:data.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")(data,params.orderBy()):data;params.total(orderedData.length);$defer.resolve(orderedData)}});angular.forEach($scope.tests,function(test){var success_len=test["success"].length;var fixed_len=test["fixed"].length;var failure_len=test["failure"].length;var error_len=test["error"].length;var data=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]);var options={title:test.name,is3D:true,colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.charts.push({data:data,options:options,type:"PieChart",displayed:true})})});metadataApi.getRawFiles().then(function(responses){$scope.metadata1=responses[0].data;$scope.metadata2=responses[1].data;$scope.dataLoaded=true});$scope.aceLoaded1=function(_editor){$scope.editor1=_editor};$scope.aceChanged1=function(_editor){};$scope.aceLoaded2=function(_editor){$scope.editor2=_editor};$scope.aceChanged2=function(_editor){}}]);myApp.controller("reviewWebFontsController",["$scope","$http","reviewApi",function($scope,$http,reviewApi){$scope.missing_chars_hidden=false;$scope.dataLoaded=false;$scope.toggleMissingGlyphs=function(){try{var glyphSpans=document.getElementById("glyphContainer").getElementsByTagName("span");for(var i=0;i<glyphSpans.length;i++){var glyphSpan=glyphSpans[i];if(glyphSpan.getAttribute("class")=="missing-glyph"){var parent_div=angular.element(glyphSpan.parentNode).parent();if(glyphSpan.parentNode.style.display=="none"){if(parent_div[0].style.display=="none"){parent_div[0].style.display="block"}glyphSpan.parentNode.style.display="block"}else{if(parent_div[0].style.display=="block"){parent_div[0].style.display="none"}glyphSpan.parentNode.style.display="none"}}}$scope.missing_chars_hidden=!$scope.missing_chars_hidden}catch(e){}};$scope.updateParentStyle=function(val){return val?"none":"block"};reviewApi.getOrthography().then(function(response){var orthography=response.data;$scope.dataLoaded=true;$scope.glyphs=[];angular.forEach(orthography,function(font){angular.forEach(font.glyphs,function(glyph){$scope.glyphs.push({glyph:glyph,is_missing:font.missing_glyphs.indexOf(glyph)!=-1})})})})}]);myApp.controller("reviewGlyphInspectorController",["$scope","$rootScope","$window","$route","appConfig",function($scope,$rootScope,$window,$route,appConfig){$scope.dataLoaded=false;var cellCount=100,cellWidth=44,cellHeight=40,cellMarginTop=1,cellMarginBottom=8,cellMarginLeftRight=1,glyphMargin=5;var pageSelected,font,fontScale,fontSize,fontBaseline,glyphScale,glyphSize,glyphBaseline;function showErrorMessage(message){var el=document.getElementById("message");if(!message||message.trim().length===0){el.style.display="none"}else{el.style.display="block"}el.innerHTML=message}function pathCommandToString(cmd){var str="<strong>"+cmd.type+"</strong> "+(cmd.x!==undefined?"x="+cmd.x+" y="+cmd.y+" ":"")+(cmd.x1!==undefined?"x1="+cmd.x1+" y1="+cmd.y1+" ":"")+(cmd.x2!==undefined?"x2="+cmd.x2+" y2="+cmd.y2:"");return str}function contourToString(contour){return'<pre class="contour">'+contour.map(function(point){return'<span class="'+(point.onCurve?"on":"off")+'curve">x='+point.x+" y="+point.y+"</span>"}).join("\n")+"</pre>"}function displayGlyphData(glyphIndex){var container=document.getElementById("glyph-data");if(glyphIndex<0){container.innerHTML="";return}var glyph=$window.font.glyphs[glyphIndex],html="<dl><dt>index</dt><dd>"+glyph.index+"</dd>";if($window.font.glyphIndexToName){html+="<dt>name</dt><dd>"+$window.font.glyphIndexToName(glyph.index)+"</dd>"}if(glyph.xMin!==0||glyph.xMax!==0||glyph.yMin!==0||glyph.yMax!==0){html+="<dt>xMin</dt><dd>"+glyph.xMin+"</dd>"+"<dt>xMax</dt><dd>"+glyph.xMax+"</dd>"+"<dt>yMin</dt><dd>"+glyph.yMin+"</dd>"+"<dt>yMax</dt><dd>"+glyph.yMax+"</dd>"}html+="<dt>advanceWidth</dt><dd>"+glyph.advanceWidth+"</dd>";if(glyph.leftSideBearing!==undefined){html+="<dt>leftSideBearing</dt><dd>"+glyph.leftSideBearing+"</dd>"}html+="</dl>";if(glyph.path){html+="path:<br><pre>  "+glyph.path.commands.map(pathCommandToString).join("\n  ")+"\n</pre>"}else if(glyph.numberOfContours>0){var contours=glyph.getContours();html+="contours:<br>"+contours.map(contourToString).join("\n")}else if(glyph.isComposite){html+="<br>This composite glyph is a combination of :<ul><li>"+glyph.components.map(function(component){return"glyph "+component.glyphIndex+" at dx="+component.dx+", dy="+component.dy}).join("</li><li>")+"</li></ul>"}container.innerHTML=html}var arrowLength=10,arrowAperture=4;function drawArrow(ctx,x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1,segmentLength=Math.sqrt(dx*dx+dy*dy),unitx=dx/segmentLength,unity=dy/segmentLength,basex=x2-arrowLength*unitx,basey=y2-arrowLength*unity,normalx=arrowAperture*unity,normaly=-arrowAperture*unitx;ctx.beginPath();ctx.moveTo(x2,y2);ctx.lineTo(basex+normalx,basey+normaly);ctx.lineTo(basex-normalx,basey-normaly);ctx.lineTo(x2,y2);ctx.closePath();ctx.fill()}function drawPathWithArrows(ctx,path){var i,cmd,x1,y1,x2,y2;var arrows=[];ctx.beginPath();for(i=0;i<path.commands.length;i+=1){cmd=path.commands[i];if(cmd.type==="M"){if(x1!==undefined){arrows.push([ctx,x1,y1,x2,y2])}ctx.moveTo(cmd.x,cmd.y)}else if(cmd.type==="L"){ctx.lineTo(cmd.x,cmd.y);x1=x2;y1=y2}else if(cmd.type==="C"){ctx.bezierCurveTo(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y);x1=cmd.x2;y1=cmd.y2}else if(cmd.type==="Q"){ctx.quadraticCurveTo(cmd.x1,cmd.y1,cmd.x,cmd.y);x1=cmd.x1;y1=cmd.y1}else if(cmd.type==="Z"){arrows.push([ctx,x1,y1,x2,y2]);ctx.closePath()}x2=cmd.x;y2=cmd.y}if(path.fill){ctx.fillStyle=path.fill;ctx.fill()}if(path.stroke){ctx.strokeStyle=path.stroke;ctx.lineWidth=path.strokeWidth;ctx.stroke()}ctx.fillStyle="#000000";arrows.forEach(function(arrow){drawArrow.apply(null,arrow)})}function displayGlyph(glyphIndex){var canvas=document.getElementById("glyph"),ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);if(glyphIndex<0)return;var glyph=$window.font.glyphs[glyphIndex],glyphWidth=glyph.advanceWidth*glyphScale,xmin=(canvas.width-glyphWidth)/2,xmax=(canvas.width+glyphWidth)/2,x0=xmin,markSize=10;ctx.fillStyle="#606060";ctx.fillRect(xmin-markSize+1,glyphBaseline,markSize,1);ctx.fillRect(xmin,glyphBaseline,1,markSize);ctx.fillRect(xmax,glyphBaseline,markSize,1);ctx.fillRect(xmax,glyphBaseline,1,markSize);ctx.textAlign="center";ctx.fillText("0",xmin,glyphBaseline+markSize+10);ctx.fillText(glyph.advanceWidth,xmax,glyphBaseline+markSize+10);ctx.fillStyle="#000000";var path=glyph.getPath(x0,glyphBaseline,glyphSize);path.fill="#808080";path.stroke="#000000";path.strokeWidth=1.5;drawPathWithArrows(ctx,path);glyph.drawPoints(ctx,x0,glyphBaseline,glyphSize)}function renderGlyphItem(canvas,glyphIndex){var cellMarkSize=4;var ctx=canvas.getContext("2d");ctx.clearRect(0,0,cellWidth,cellHeight);if(glyphIndex>=$window.font.numGlyphs)return;ctx.fillStyle="#606060";ctx.font="9px sans-serif";ctx.fillText(glyphIndex,1,cellHeight-1);var glyph=$window.font.glyphs[glyphIndex],glyphWidth=glyph.advanceWidth*fontScale,xmin=(cellWidth-glyphWidth)/2,xmax=(cellWidth+glyphWidth)/2,x0=xmin;ctx.fillStyle="#a0a0a0";ctx.fillRect(xmin-cellMarkSize+1,fontBaseline,cellMarkSize,1);ctx.fillRect(xmin,fontBaseline,1,cellMarkSize);ctx.fillRect(xmax,fontBaseline,cellMarkSize,1);ctx.fillRect(xmax,fontBaseline,1,cellMarkSize);ctx.fillStyle="#000000";glyph.draw(ctx,x0,fontBaseline,fontSize)}function displayGlyphPage(pageNum){pageSelected=pageNum;document.getElementById("p"+pageNum).className="page-selected";var firstGlyph=pageNum*cellCount;for(var i=0;i<cellCount;i++){renderGlyphItem(document.getElementById("g"+i),firstGlyph+i)}}function pageSelect(event){document.getElementsByClassName("page-selected")[0].className="";displayGlyphPage(+event.target.id.substr(1))}function initGlyphDisplay(){var glyphBgCanvas=document.getElementById("glyph-bg"),w=glyphBgCanvas.width,h=glyphBgCanvas.height,glyphW=w-glyphMargin*2,glyphH=h-glyphMargin*2,head=$window.font.tables.head,maxHeight=head.yMax-head.yMin,ctx=glyphBgCanvas.getContext("2d");glyphScale=Math.min(glyphW/(head.xMax-head.xMin),glyphH/maxHeight);glyphSize=glyphScale*$window.font.unitsPerEm;glyphBaseline=glyphMargin+glyphH*head.yMax/maxHeight;function hline(text,yunits){ypx=glyphBaseline-yunits*glyphScale;ctx.fillText(text,2,ypx+3);ctx.fillRect(80,ypx,w,1)}ctx.clearRect(0,0,w,h);ctx.fillStyle="#a0a0a0";hline("Baseline",0);hline("yMax",$window.font.tables.head.yMax);hline("yMin",$window.font.tables.head.yMin);hline("Ascender",$window.font.tables.hhea.ascender);hline("Descender",$window.font.tables.hhea.descender);hline("Typo Ascender",$window.font.tables.os2.sTypoAscender);hline("Typo Descender",$window.font.tables.os2.sTypoDescender)}function onFontLoaded(font){window.font=font;$window.font=font;var w=cellWidth-cellMarginLeftRight*2,h=cellHeight-cellMarginTop-cellMarginBottom,head=$window.font.tables.head,maxHeight=head.yMax-head.yMin;fontScale=Math.min(w/(head.xMax-head.xMin),h/maxHeight);fontSize=fontScale*$window.font.unitsPerEm;fontBaseline=cellMarginTop+h*head.yMax/maxHeight;var pagination=document.getElementById("pagination");pagination.innerHTML="";var fragment=document.createDocumentFragment();var numPages=Math.ceil($window.font.numGlyphs/cellCount);for(var i=0;i<numPages;i++){var link=document.createElement("span");var lastIndex=Math.min($window.font.numGlyphs-1,(i+1)*cellCount-1);link.textContent=i*cellCount+"-"+lastIndex;link.id="p"+i;link.addEventListener("click",pageSelect,false);fragment.appendChild(link);fragment.appendChild(document.createTextNode(" "))}pagination.appendChild(fragment);initGlyphDisplay();displayGlyphPage(0);displayGlyph(-1);displayGlyphData(-1)}function onReadFile(e){document.getElementById("font-name").innerHTML="";var file=e.target.files[0];var reader=new FileReader;reader.onload=function(e){try{$window.font=opentype.parse(e.target.result);showErrorMessage("");onFontLoaded($window.font)}catch(err){showErrorMessage(err.toString());throw err}};reader.onerror=function(err){showErrorMessage(err.toString())};reader.readAsArrayBuffer(file)}function cellSelect(event){if(!$window.font)return;var firstGlyphIndex=pageSelected*cellCount,cellIndex=+event.target.id.substr(1),glyphIndex=firstGlyphIndex+cellIndex;if(glyphIndex<$window.font.numGlyphs){displayGlyph(glyphIndex);displayGlyphData(glyphIndex)}}function prepareGlyphList(){var marker=document.getElementById("glyph-list-end"),parent=marker.parentElement;for(var i=0;i<cellCount;i++){var canvas=document.createElement("canvas");canvas.width=cellWidth;canvas.height=cellHeight;canvas.className="item";canvas.id="g"+i;canvas.addEventListener("click",cellSelect,false);parent.insertBefore(canvas,marker)}}angular.element(document).ready(function(){$scope.dataLoaded=true;if($rootScope.metadata.fonts.length>0){var fontFileName=[appConfig.base_url,$route.current.params.repo_owner,$route.current.params.repo_name,"gh-pages/build_info/static/css/fonts",$rootScope.metadata.fonts[0].filename].join("/");var parser=document.createElement("a");parser.href=fontFileName;document.getElementById("font-name").innerHTML=parser.href.substr(parser.href.lastIndexOf("/")+1);var fileButton=document.getElementById("file");fileButton.addEventListener("change",onReadFile,false);prepareGlyphList();opentype.load(fontFileName,function(err,font){var amount,glyph,ctx,x,y,fontSize;if(err){showErrorMessage(err.toString());return}onFontLoaded(font)})}})}]);myApp.controller("summaryController",["$scope","$rootScope","$http","$filter","$document","summaryApi","Mixins","ngTableParams",function($scope,$rootScope,$http,$filter,$document,summaryApi,Mixins,ngTableParams){$scope.pie_charts=[];$scope.average_pie_chart=null;$scope.average_line_chart=null;$scope.deviation_line_chart=null;$scope.tests=null;$scope.metrics=null;$scope.faces={};$scope.table_sizes=null;$scope.autohint_sizes=null;$scope.fontaine_fonts=null;$scope.fonts_orthography=null;$scope.fonts_tables_grouped=null;$scope.fontSupportToStyle={full:"success",partial:"info",fragmentary:"warning",unsupported:"danger"};angular.forEach([100,200,300,400,500,600,700,800,900],function(weight){$scope.faces[weight]=$rootScope.metadata.fonts.filter(function(face){return face.weight==weight})});summaryApi.getMetrics().then(function(response){$scope.metrics=response.data});summaryApi.getTableSizes().then(function(response){$scope.table_sizes=response.data});summaryApi.getAutohintSizes().then(function(response){$scope.autohint_sizes=response.data});summaryApi.getFontaineFonts().then(function(response){$scope.fontaine_fonts=response.data});summaryApi.getFontsOrthography().then(function(response){$scope.fonts_orthography=response.data});summaryApi.getTests().then(function(response){$scope.tests=response.data;var watch_list=["error","failure","fixed"];var watch_tag="required";var data=[];angular.forEach($scope.tests,function(test){angular.forEach($scope.resultMap,function(result_val,result_key){if(watch_list.indexOf(result_key)!=-1){angular.forEach(test[result_key],function(test_obj){if(test_obj.tags.indexOf(watch_tag)!=-1){var item={font:test.name,orig_data:test_obj,categories:test_obj.tags.join(", "),description:test_obj.methodDoc,result_msg:test_obj.err_msg,result_status:$scope.statusMap[result_key],result_class:result_val};data.push(item)}})}})});$scope.testsTableParams=new ngTableParams({page:1,count:data.length,sorting:{result_status:"asc"}},{counts:[],total:data.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")(data,params.orderBy()):data;params.total(orderedData.length);$defer.resolve(orderedData)}});var chartsum={success:0,failure:0,fixed:0,error:0};angular.forEach($scope.tests,function(test){var success_len=test["success"].length,fixed_len=test["fixed"].length,failure_len=test["failure"].length,error_len=test["error"].length,gdata=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]),options={title:test.name,is3D:true,colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.pie_charts.push({data:gdata,options:options,type:"PieChart",displayed:true});chartsum={success:chartsum.success+success_len,error:error_len,failure:chartsum.failure+failure_len,fixed:chartsum.fixed+fixed_len}});if($scope.tests.length>1){var success_len=chartsum.success,fixed_len=chartsum.fixed,failure_len=chartsum.failure,error_len=chartsum.error,gdata=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]),options={title:"Average",is3D:true,colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.average_pie_chart={data:gdata,options:options,type:"PieChart",displayed:true}}});summaryApi.getFontsTableGrouped().then(function(response){$scope.fonts_tables_grouped=response.data;var headings=["Table","Average"].concat($scope.fonts_tables_grouped.grouped.fonts);var aggregated_table=[];aggregated_table.push(headings);angular.forEach($scope.fonts_tables_grouped.grouped.tables,function(table){aggregated_table.push(table)});var average_data=google.visualization.arrayToDataTable(aggregated_table);var average_options={title:"Fonts compared to average",is3D:true,vAxis:{title:"Size (bytes)"},hAxis:{slantedText:true},height:500};$scope.average_line_chart={data:average_data,options:average_options,type:"LineChart",displayed:true};var headings2=["Table"].concat($scope.fonts_tables_grouped.delta.fonts);var deviation_table=[];deviation_table.push(headings2);angular.forEach($scope.fonts_tables_grouped.delta.tables,function(table){deviation_table.push(table)});var data2=google.visualization.arrayToDataTable(deviation_table);var options2={bar:{groupWidth:"68%"},title:"Deviation from an average",is3D:true,vAxis:{title:"Deviation (bytes)"},hAxis:{slantedText:true},height:500};$scope.deviation_line_chart={data:data2,options:options2,type:"ColumnChart",displayed:true}});$scope.isReady=function(){return!Mixins.checkAll(null,$scope.metrics,$scope.tests,$scope.faces,$scope.table_sizes,$scope.autohint_sizes,$scope.fontaine_fonts,$scope.fonts_orthography)};$document.ready(function(){$document.on("click","td.coverageStats",function(){var hidden_td=angular.element(this).closest("td").next(),missing_chars=hidden_td.html(),subset=hidden_td.attr("data-subset"),font=hidden_td.attr("data-fontname");angular.element("#myModalInfo").html("<h5>"+font+"</h5><small>"+subset+"</small>");angular.element(".modal-body").html(missing_chars)}).on("click","td.coverageAverage",function(){var parent_tr=angular.element(this).parent("tr"),subset=angular.element(parent_tr).find("td.missing-chars:first").attr("data-subset"),modal_body=angular.element(".modal-body");modal_body.empty();angular.element("#myModalInfo").html("<h5>"+subset+"</h5>");angular.element(parent_tr).find("td.missing-chars").each(function(i){var font=angular.element(this).attr("data-fontname"),missing_chars=angular.element(this).html();modal_body.append("<strong>"+font+"</strong>"+missing_chars+"<hr>")})})})}]);myApp.controller("testsController",["$scope","$http","$filter","PathBuilder","testsApi","ngTableParams",function($scope,$http,$filter,PathBuilder,testsApi,ngTableParams){$scope.charts=[];$scope.average_chart=null;$scope.dataLoaded=false;testsApi.getTests().then(function(response){$scope.tests=response.data;$scope.dataLoaded=true;var data=[];angular.forEach($scope.tests,function(test){angular.forEach($scope.resultMap,function(result_val,result_key){angular.forEach(test[result_key],function(test_obj){var item={font:test.name,orig_data:test_obj,categories:test_obj.tags.join(", "),description:test_obj.methodDoc,result_msg:test_obj.err_msg,result_status:$scope.statusMap[result_key],result_class:result_val,gh_link:PathBuilder.buildPath($scope.repo_info.fontbakery.master_url,$filter("replace")(test_obj.name,".","/")+".py")};data.push(item)})})});$scope.testsTableParams=new ngTableParams({page:1,count:data.length,sorting:{result_status:"asc"}},{counts:[],total:data.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")(data,params.orderBy()):data;params.total(orderedData.length);$defer.resolve(orderedData)}});var chartsum={success:0,failure:0,fixed:0,error:0};angular.forEach($scope.tests,function(test){var success_len=test["success"].length,fixed_len=test["fixed"].length,failure_len=test["failure"].length,error_len=test["error"].length,gdata=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]),options={title:test.name,is3D:true,chartArea:{width:"100%"},colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.charts.push({data:gdata,options:options,type:"PieChart",displayed:true});chartsum={success:chartsum.success+success_len,error:error_len,failure:chartsum.failure+failure_len,fixed:chartsum.fixed+fixed_len}});if($scope.tests.length>1){var success_len=chartsum.success,fixed_len=chartsum.fixed,failure_len=chartsum.failure,error_len=chartsum.error,gdata=google.visualization.arrayToDataTable([["Tests","#"],["Success "+success_len,success_len],["Fixed "+fixed_len,fixed_len],["Failed "+failure_len,failure_len],["Error "+error_len,error_len]]),options={title:"Average",is3D:true,chartArea:{width:"100%"},colors:["#468847","#3a87ad","#b94a48","#c09853"]};$scope.average_chart={data:gdata,options:options,type:"PieChart",displayed:true}}})}]);angular.module("myApp").controller("reposController",["$scope","$rootScope","$routeParams","$filter","$q","$http","$window","$queue","reposApi","ngTableParams",function($scope,$rootScope,$routeParams,$filter,$q,$http,$window,$queue,reposApi,ngTableParams){$scope.dataLoaded=false;$scope.OAuth_passed=false;$scope.reqCounter=0;$scope.filteredTreeData=0;$scope.itemsLoaded=false;$scope.tableInitialized=false;var data=[],build_date_errors=[],tests_passing_errors=[];$scope.getItemsLoaded=function(){var current=parseFloat($scope.reqCounter/2);var total=$scope.filteredTreeData.length;$scope.itemsLoaded=current>=total-1?true:false;return parseInt(current)+"/"+parseInt(total)};var getBuildCallback=function(item){if(!item.hasOwnProperty("buildIsResolved")){item.getBuildInfoCallback({build:item})}},getTestsInfoCallback=function(item){if(!item.hasOwnProperty("testsIsResolved")){item.getTestsInfoCallback({build:item})}},options={delay:200,paused:true};$rootScope.itemsQueue={build:$queue.queue(getBuildCallback,options),tests:$queue.queue(getTestsInfoCallback,options)};var getBuildInfo=function(scope){$http.get("https://api.travis-ci.org/repos/fontdirectory/"+scope.build.repoName,{headers:{Accept:"application/vnd.travis-ci.2+json"},nointercept:true}).then(function(dataResponse){scope.build["buildDateOrig"]=dataResponse.data.repo.last_build_finished_at;scope.build["buildStatus"]=dataResponse.data.repo.last_build_state;scope.build["buildIsResolved"]=true;$scope.reqCounter++},function(error){$scope.reqCounter++;build_date_errors.push(error.status+" - "+error.statusText+": "+error.config.url);scope.build["buildDateOrig"]=null;scope.build["buildStatus"]=null;scope.build["buildIsResolved"]=false})};var getTestsInfo=function(scope){$http.get("https://rawgit.com/fontdirectory/"+scope.build.repoName+"/gh-pages/summary.tests.json",{nointercept:true}).then(function(dataResponse){var tests_data=dataResponse.data,totalTests=0,successTests=0,failureTests=0,fixedTests=0,errorTests=0;$scope.reqCounter++;for(d in tests_data){totalTests+=tests_data[d].success+tests_data[d].error+tests_data[d].failure;successTests+=tests_data[d].success;failureTests+=tests_data[d].failure;errorTests+=tests_data[d].error;fixedTests+=tests_data[d].fixed}scope.build["totalTests"]=totalTests;scope.build["successTests"]=successTests;scope.build["passingTestsPercentage"]=Math.round(successTests/totalTests*100);scope.build["failureTests"]=failureTests;scope.build["failureTestsPercentage"]=Math.round(failureTests/totalTests*100);scope.build["fixedTests"]=fixedTests;scope.build["fixedTestsPercentage"]=Math.round(fixedTests/totalTests*100);scope.build["errorTests"]=errorTests;scope.build["errorTestsPercentage"]=Math.round(errorTests/totalTests*100);scope.build["testsIsResolved"]=true},function(error){$scope.reqCounter++;tests_passing_errors.push(error.status+" - "+error.statusText+": "+error.config.url);scope.build["totalTests"]=null;scope.build["successTests"]=null;scope.build["passingTestsPercentage"]=null;scope.build["failureTests"]=null;scope.build["failureTestsPercentage"]=null;scope.build["fixedTests"]=null;scope.build["fixedTestsPercentage"]=null;scope.build["errorTests"]=null;scope.build["errorTestsPercentage"]=null;scope.build["noTestsInfo"]={status:error.status+" - "+error.statusText,url:error.config.url};scope.build["testsIsResolved"]=false})};$scope.init=function(){reposApi.getCollection($scope.$storage.OAuth_result["access_token"]).then(function(dataResponse){$scope.filteredTreeData=dataResponse.data.tree.filter(function(item){return"160000"==item.mode&&"commit"==item.type&&item.path.split("/")[1]!="fontbakery"});$scope.buildsTableParams=new ngTableParams({page:1,count:$scope.filteredTreeData.length,sorting:{repoPath:"asc"}},{counts:[],total:$scope.filteredTreeData.length,getData:function($defer,params){if($scope.filteredTreeData.length!=data.length){angular.forEach($scope.filteredTreeData,function(item,index){var info={};var path=item.path.split("/")[1];info["repoPath"]=item.path;info["repoName"]=path;info["repoLink"]="https://github.com/fontdirectory/"+path;info["travisLink"]="http://travis-ci.org/fontdirectory/"+path;info["travisImg"]="https://travis-ci.org/fontdirectory/"+path+".svg";info["reportLink"]="https://fontdirectory.github.io/"+path;info["getBuildInfoCallback"]=getBuildInfo;info["getTestsInfoCallback"]=getTestsInfo;data.push(info);$rootScope.itemsQueue.build.add(info);$rootScope.itemsQueue.tests.add(info)})}var filteredData=$filter("filter")(data,$rootScope.repo_selected.name,function(val1,val2){return $scope.filterWithQuicksilverRanking(val1,val2)});var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):data;$defer.resolve(orderedData);$scope.dataLoaded=true;$rootScope.itemsQueue.build.start();$rootScope.itemsQueue.tests.start()}})},function(error){$scope.alerts.addAlert(error.message)})};$rootScope.$watch("repo_selected",function(repo_selected){if($scope.buildsTableParams){$scope.buildsTableParams.reload()}},true);$scope.$watch("reqCounter",function(reqCounter){if(!$scope.tableInitialized&&$scope.itemsLoaded&&$scope.filteredTreeData.length==data.length){$scope.tableInitialized=true;if($scope.buildsTableParams){$scope.buildsTableParams.sorting()}if(build_date_errors.length>0){$scope.alerts.addAlert("Build dates for "+build_date_errors.length+" projects could not be found, so those projects have no date in the table below. Try rebuliding them.","warning")}if(tests_passing_errors.length>0){$scope.alerts.addAlert("Test results for "+tests_passing_errors.length+" projects could not be found, so those projects have an orange N/A result in the table below. Try rebuliding them.","warning")}}});$scope.init()}]);
//@ sourceMappingURL=static/js/all.js.map